local savedSpeed = 50

local function gui()
    local Players = game:GetService("Players")
    local RunService = game:GetService("RunService")
    local UserInputService = game:GetService("UserInputService")
    local TweenService = game:GetService("TweenService")
    
    local player = Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")
    local HRP = character:WaitForChild("HumanoidRootPart")
    local Camera = workspace.CurrentCamera

    local baseSpeed = savedSpeed
    local flySpeed = baseSpeed
    local flying = false
    local forwardHold = 0
    local inputFlags = { forward = false, back = false, left = false, right = false, up = false, down = false }

    -- Fizik Nesneleri
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    local bodyGyro = Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(1e5, 1e5, 1e5)

    -- --- ARAYÜZ OLUŞTURMA ---
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ModernFlyGui"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = player:WaitForChild("PlayerGui")

    -- Ana Panel
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.new(0, 200, 0, 150)
    MainFrame.Position = UDim2.new(0.5, -100, 0.5, -75)
    MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    MainFrame.BorderSizePixel = 0
    MainFrame.Active = true
    MainFrame.Draggable = true -- Sürüklenebilir özellik
    MainFrame.Parent = screenGui

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = MainFrame

    local Title = Instance.new("TextLabel")
    Title.Text = "GEMINI FLY V2"
    Title.Size = UDim2.new(1, 0, 0, 30)
    Title.BackgroundTransparency = 1
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 14
    Title.Parent = MainFrame

    -- Fly Toggle Butonu
    local toggleButton = Instance.new("TextButton")
    toggleButton.Name = "ToggleBtn"
    toggleButton.Text = "FLY: OFF"
    toggleButton.Size = UDim2.new(0, 160, 0, 40)
    toggleButton.Position = UDim2.new(0.5, -80, 0, 40)
    toggleButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggleButton.Font = Enum.Font.GothamBold
    toggleButton.TextSize = 14
    toggleButton.Parent = MainFrame
    Instance.new("UICorner", toggleButton).CornerRadius = UDim.new(0, 6)

    -- Hız Girişi Alanı
    local speedLabel = Instance.new("TextLabel")
    speedLabel.Text = "SPEED:"
    speedLabel.Size = UDim2.new(0, 60, 0, 30)
    speedLabel.Position = UDim2.new(0, 20, 0, 95)
    speedLabel.BackgroundTransparency = 1
    speedLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    speedLabel.Font = Enum.Font.Gotham
    speedLabel.TextSize = 12
    speedLabel.Parent = MainFrame

    local speedBox = Instance.new("TextBox")
    speedBox.Name = "SpeedBox"
    speedBox.Text = tostring(baseSpeed)
    speedBox.Size = UDim2.new(0, 90, 0, 30)
    speedBox.Position = UDim2.new(0, 85, 0, 95)
    speedBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    speedBox.TextColor3 = Color3.fromRGB(0, 255, 150)
    speedBox.Font = Enum.Font.GothamBold
    speedBox.TextSize = 14
    speedBox.Parent = MainFrame
    Instance.new("UICorner", speedBox).CornerRadius = UDim.new(0, 4)

    -- Animasyon ve Uçuş Mantığı (Senin Kodun)
    local function newAnim(id)
        local anim = Instance.new("Animation")
        anim.AnimationId = "rbxassetid://" .. id
        return anim
    end

    local animations = {
        forward = newAnim(90872539), up = newAnim(90872539),
        right1 = newAnim(136801964), right2 = newAnim(142495255),
        left1 = newAnim(136801964), left2 = newAnim(142495255),
        flyLow1 = newAnim(97169019), flyLow2 = newAnim(282574440),
        flyFast = newAnim(282574440), back1 = newAnim(136801964),
        back2 = newAnim(106772613), back3 = newAnim(42070810),
        back4 = newAnim(214744412), down = newAnim(233322916),
        idle1 = newAnim(97171309)
    }

    local tracks = {}
    for name, anim in pairs(animations) do
        tracks[name] = humanoid:LoadAnimation(anim)
    end

    local function stopAll()
        for _, track in pairs(tracks) do track:Stop() end
    end

    local function startFlying()
        flying = true
        forwardHold = 0
        flySpeed = baseSpeed
        bodyVelocity.Parent = HRP
        bodyGyro.Parent = HRP
        humanoid.PlatformStand = true
        toggleButton.Text = "FLY: ON"
        toggleButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
    end

    local function stopFlying()
        flying = false
        bodyVelocity.Parent = nil
        bodyGyro.Parent = nil
        humanoid.PlatformStand = false
        stopAll()
        toggleButton.Text = "FLY: OFF"
        toggleButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    end

    toggleButton.MouseButton1Click:Connect(function()
        if flying then stopFlying() else startFlying() end
    end)

    speedBox.FocusLost:Connect(function()
        local num = tonumber(speedBox.Text)
        if num and num > 0 then
            baseSpeed = num
            savedSpeed = num
            if flying then flySpeed = baseSpeed end
        else
            speedBox.Text = tostring(baseSpeed)
        end
    end)

    -- Giriş Kontrolleri
    UserInputService.InputBegan:Connect(function(input, gpe)
        if gpe then return end
        if input.KeyCode == Enum.KeyCode.W then inputFlags.forward = true end
        if input.KeyCode == Enum.KeyCode.S then inputFlags.back = true end
        if input.KeyCode == Enum.KeyCode.A then inputFlags.left = true end
        if input.KeyCode == Enum.KeyCode.D then inputFlags.right = true end
        if input.KeyCode == Enum.KeyCode.E then inputFlags.up = true end
        if input.KeyCode == Enum.KeyCode.Q then inputFlags.down = true end
    end)

    UserInputService.InputEnded:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.W then inputFlags.forward = false end
        if input.KeyCode == Enum.KeyCode.S then inputFlags.back = false end
        if input.KeyCode == Enum.KeyCode.A then inputFlags.left = false false end
        if input.KeyCode == Enum.KeyCode.D then inputFlags.right = false end
        if input.KeyCode == Enum.KeyCode.E then inputFlags.up = false end
        if input.KeyCode == Enum.KeyCode.Q then inputFlags.down = false end
    end)

    RunService.RenderStepped:Connect(function(dt)
        if not flying then return end
        if not inputFlags.forward then forwardHold = 0 end

        local dir = Vector3.zero
        local camCF = Camera.CFrame

        if inputFlags.forward then dir += camCF.LookVector end
        if inputFlags.back then dir -= camCF.LookVector end
        if inputFlags.left then dir -= camCF.RightVector end
        if inputFlags.right then dir += camCF.RightVector end
        if inputFlags.up then dir += Vector3.yAxis end
        if inputFlags.down then dir -= Vector3.yAxis end

        if dir.Magnitude > 0 then dir = dir.Unit end

        bodyVelocity.Velocity = dir * flySpeed
        bodyGyro.CFrame = camCF

        -- Animasyon Mantığı (Aynı Bırakıldı)
        if inputFlags.up then
            if not tracks.up.IsPlaying then stopAll(); tracks.up:Play() end
        elseif inputFlags.down then
            if not tracks.down.IsPlaying then stopAll(); tracks.down:Play() end
        elseif inputFlags.forward then
            forwardHold += dt
            if forwardHold >= 3 then
                if not tracks.flyFast.IsPlaying then
                    stopAll(); flySpeed = baseSpeed * 1.5
                    tracks.flyFast:Play()
                end
            else
                if not tracks.flyLow1.IsPlaying then
                    stopAll(); flySpeed = baseSpeed
                    tracks.flyLow1:Play(); tracks.flyLow2:Play()
                end
            end
        else
            if not tracks.idle1.IsPlaying then stopAll(); tracks.idle1:Play() end
        end
    end)
end

gui()
