local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")
local root = char:WaitForChild("HumanoidRootPart")
local cam = workspace.CurrentCamera

local flying = false
local speed = 60

-- Body movers
local bv = Instance.new("BodyVelocity")
bv.MaxForce = Vector3.new(9e9,9e9,9e9)
bv.P = 9e4

local bg = Instance.new("BodyGyro")
bg.MaxTorque = Vector3.new(9e9,9e9,9e9)
bg.P = 9e4

-- GUI
local gui = Instance.new("ScreenGui", player.PlayerGui)
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0,140,0,60)
frame.Position = UDim2.new(0,20,0.5,0)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.Active = true
frame.Draggable = true

local toggle = Instance.new("TextButton", frame)
toggle.Size = UDim2.new(1,-20,1,-20)
toggle.Position = UDim2.new(0,10,0,10)
toggle.BackgroundColor3 = Color3.fromRGB(50,50,50)
toggle.TextColor3 = Color3.new(1,1,1)
toggle.Font = Enum.Font.GothamBold
toggle.TextScaled = true
toggle.Text = "FLY OFF"

-- Movement
local keys = {W=false,A=false,S=false,D=false}

UIS.InputBegan:Connect(function(i,g)
    if g then return end
    if keys[i.KeyCode.Name] ~= nil then
        keys[i.KeyCode.Name] = true
    end
end)

UIS.InputEnded:Connect(function(i)
    if keys[i.KeyCode.Name] ~= nil then
        keys[i.KeyCode.Name] = false
    end
end)

local function startFly()
    flying = true
    bv.Parent = root
    bg.Parent = root
    toggle.Text = "FLY ON"
end

local function stopFly()
    flying = false
    bv.Parent = nil
    bg.Parent = nil
    toggle.Text = "FLY OFF"
end

toggle.MouseButton1Click:Connect(function()
    if flying then
        stopFly()
    else
        startFly()
    end
end)

RunService.RenderStepped:Connect(function()
    if not flying then return end

    local move = Vector3.zero
    local cf = cam.CFrame

    if keys.W then move += cf.LookVector end
    if keys.S then move -= cf.LookVector end
    if keys.A then move -= cf.RightVector end
    if keys.D then move += cf.RightVector end

    if move.Magnitude > 0 then
        move = move.Unit * speed
    end

    -- Oturma bozulmasÄ±n diye PlatformStand yok
    bv.Velocity = move
    bg.CFrame = cf
end)

-- Respawn fix
player.CharacterAdded:Connect(function(c)
    char = c
    hum = char:WaitForChild("Humanoid")
    root = char:WaitForChild("HumanoidRootPart")
end)
