local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local ToggleButton = Instance.new("TextButton")
local UICorner = Instance.new("UICorner")
local UIStroke = Instance.new("UIStroke")
local Title = Instance.new("TextLabel")

-- GUI Ayarları
ScreenGui.Name = "FlyGui_v1"
ScreenGui.Parent = game:GetService("CoreGui") -- Resetlendiğinde gitmemesi için CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.Position = UDim2.new(0.05, 0, 0.4, 0)
MainFrame.Size = UDim2.new(0, 150, 0, 80)
MainFrame.Active = true
MainFrame.Draggable = true -- Mouse ile taşıyabilirsin

UICorner.Parent = MainFrame

UIStroke.Parent = MainFrame
UIStroke.Thickness = 2
UIStroke.Color = Color3.fromRGB(85, 170, 255)

Title.Name = "Title"
Title.Parent = MainFrame
Title.BackgroundTransparency = 1
Title.Size = UDim2.new(1, 0, 0.4, 0)
Title.Font = Enum.Font.GothamBold
Title.Text = "FLY SYSTEM"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 14

ToggleButton.Name = "ToggleButton"
ToggleButton.Parent = MainFrame
ToggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
ToggleButton.Position = UDim2.new(0.1, 0, 0.45, 0)
ToggleButton.Size = UDim2.new(0.8, 0, 0.4, 0)
ToggleButton.Font = Enum.Font.GothamSemibold
ToggleButton.Text = "DURUM: KAPALI"
ToggleButton.TextColor3 = Color3.fromRGB(255, 100, 100)
ToggleButton.TextSize = 12

Instance.new("UICorner", ToggleButton)

--------------------------------------------------------------------------
-- SENİN FLY KODUNUN ENTEGRESİ
--------------------------------------------------------------------------

local speeds = 1
local nowe = false
local speaker = game:GetService("Players").LocalPlayer
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

local bg, bv
local tpwalking = false

local function forceStates(hum)
    for _,state in pairs(Enum.HumanoidStateType:GetEnumItems()) do
        hum:SetStateEnabled(state, true)
    end
end

local function startFly()
    nowe = true
    ToggleButton.Text = "DURUM: AÇIK"
    ToggleButton.TextColor3 = Color3.fromRGB(100, 255, 100)

    local chr = speaker.Character
    local hum = chr:FindFirstChildWhichIsA("Humanoid")
    local root = chr:FindFirstChild("HumanoidRootPart")

    if not hum or not root then return end

    forceStates(hum)

    task.spawn(function()
        local hb = RunService.Heartbeat
        tpwalking = true
        while tpwalking and hb:Wait() and chr and hum and hum.Parent do
            if hum.MoveDirection.Magnitude > 0 then
                chr:TranslateBy(hum.MoveDirection)
            end
        end
    end)

    chr.Animate.Disabled = true
    for _,v in next, hum:GetPlayingAnimationTracks() do
        v:AdjustSpeed(0)
    end

    bg = Instance.new("BodyGyro", root)
    bg.P = 9e4
    bg.maxTorque = Vector3.new(9e9,9e9,9e9)
    bg.cframe = root.CFrame

    bv = Instance.new("BodyVelocity", root)
    bv.velocity = Vector3.new(0,0.1,0)
    bv.maxForce = Vector3.new(9e9,9e9,9e9)

    hum.PlatformStand = true

    task.spawn(function()
        local speed = 0
        local maxspeed = 50
        while nowe and hum.Health > 0 do
            RunService.RenderStepped:Wait()
            if hum.Sit then hum.PlatformStand = true end
            if hum.MoveDirection.Magnitude > 0 then
                speed = math.min(speed + 1, maxspeed)
                bv.velocity = workspace.CurrentCamera.CFrame.LookVector * speed
            else
                speed = 0
                bv.velocity = Vector3.new()
            end
            bg.cframe = workspace.CurrentCamera.CFrame
        end
    end)
end

local function stopFly()
    nowe = false
    tpwalking = false
    ToggleButton.Text = "DURUM: KAPALI"
    ToggleButton.TextColor3 = Color3.fromRGB(255, 100, 100)

    local chr = speaker.Character
    if not chr then return end

    local hum = chr:FindFirstChildWhichIsA("Humanoid")
    if hum then
        hum.PlatformStand = false
        chr.Animate.Disabled = false
    end

    if bg then bg:Destroy() end
    if bv then bv:Destroy() end
end

-- Buton Tıklama Olayı
ToggleButton.MouseButton1Click:Connect(function()
    if nowe then stopFly() else startFly() end
end)

-- F Tuşu Entegresi
UIS.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.F then
        if nowe then stopFly() else startFly() end
    end
end)

-- Karakter Yenilenince Fix
speaker.CharacterAdded:Connect(function(char)
    task.wait(0.7)
    local hum = char:FindFirstChildWhichIsA("Humanoid")
    if hum then hum.PlatformStand = false end
    if nowe then stopFly() end -- Respawn olunca fly'ı kapatır (güvenlik için)
end)
