--// SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

--// VARIABLES
local flying = false
local speeds = 1
local maxspeed = 50  -- uçuş hız limiti (ilk scriptteki gibi)
local nowe = false   -- uçuş durumu
local tpwalking = false
local bg, bv, connection
local ctrl = {f=0,b=0,l=0,r=0}
local lastctrl = {f=0,b=0,l=0,r=0}
local speed = 0

--// GUI
local ScreenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
ScreenGui.Name = "SupermanFlyV8"
ScreenGui.ResetOnSpawn = false

local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0,200,0,240)
Main.Position = UDim2.new(0.5,-100,0.15,0)
Main.BackgroundColor3 = Color3.fromRGB(15,15,15)
Main.Active = true
Main.Draggable = true
Instance.new("UICorner", Main)

local Stroke = Instance.new("UIStroke", Main)
Stroke.Thickness = 3

local Title = Instance.new("TextLabel", Main)
Title.Size = UDim2.new(1,0,0,35)
Title.BackgroundTransparency = 1
Title.Text = "SUPERMAN FLY"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.TextColor3 = Color3.new(1,1,1)

local Toggle = Instance.new("TextButton", Main)
Toggle.Size = UDim2.new(0.8,0,0,40)
Toggle.Position = UDim2.new(0.1,0,0.25,0)
Toggle.Text = "FLY: OFF"
Toggle.Font = Enum.Font.GothamBold
Toggle.TextSize = 16
Toggle.BackgroundColor3 = Color3.fromRGB(30,30,30)
Toggle.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", Toggle)

local SpeedLabel = Instance.new("TextLabel", Main)
SpeedLabel.Size = UDim2.new(1,0,0,30)
SpeedLabel.Position = UDim2.new(0,0,0.5,0)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.Font = Enum.Font.GothamBold
SpeedLabel.TextSize = 15
SpeedLabel.TextColor3 = Color3.new(1,1,1)
SpeedLabel.Text = "TPWalk THREAD: "..speeds

local SpeedUp = Instance.new("TextButton", Main)
SpeedUp.Size = UDim2.new(0.35,0,0,30)
SpeedUp.Position = UDim2.new(0.1,0,0.65,0)
SpeedUp.Text = "+"
SpeedUp.Font = Enum.Font.GothamBold
SpeedUp.TextSize = 18
SpeedUp.BackgroundColor3 = Color3.fromRGB(40,40,40)
SpeedUp.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", SpeedUp)

local SpeedDown = Instance.new("TextButton", Main)
SpeedDown.Size = UDim2.new(0.35,0,0,30)
SpeedDown.Position = UDim2.new(0.55,0,0.65,0)
SpeedDown.Text = "-"
SpeedDown.Font = Enum.Font.GothamBold
SpeedDown.TextSize = 18
SpeedDown.BackgroundColor3 = Color3.fromRGB(40,40,40)
SpeedDown.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", SpeedDown)

-- HELP BUTTON
local HelpBtn = Instance.new("TextButton", Main)
HelpBtn.Size = UDim2.new(0.3,0,0,28)
HelpBtn.Position = UDim2.new(0.35,0,0.82,0)
HelpBtn.Text = "?"
HelpBtn.Font = Enum.Font.GothamBold
HelpBtn.TextSize = 16
HelpBtn.BackgroundColor3 = Color3.fromRGB(50,50,50)
HelpBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", HelpBtn)

local HelpFrame = Instance.new("Frame", ScreenGui)
HelpFrame.Size = UDim2.new(0,260,0,200)
HelpFrame.Position = UDim2.new(0.5,-130,0.5,-100)
HelpFrame.BackgroundColor3 = Color3.fromRGB(20,20,20)
HelpFrame.Visible = false
Instance.new("UICorner", HelpFrame)

local HelpText = Instance.new("TextLabel", HelpFrame)
HelpText.Size = UDim2.new(1,-10,1,-10)
HelpText.Position = UDim2.new(0,5,0,5)
HelpText.BackgroundTransparency = 1
HelpText.Font = Enum.Font.Gotham
HelpText.TextSize = 14
HelpText.TextColor3 = Color3.new(1,1,1)
HelpText.TextWrapped = true
HelpText.Text =
[[NASIL ÇALIŞIR

FLY ON → uçuş başlar
FLY OFF → kapanır

W → ileri
S → geri
A → sol
D → sağ

Kamera nereye bakarsa oraya uçarsın
Oturduğun araçla beraber uçarsın

+ / - butonları TPWalk thread sayısını ayarlar
(daha fazla thread = daha hızlı yürüme)

F tuşu ile de açıp kapatabilirsin]]

-- RGB EFFECT
task.spawn(function()
	local hue = 0
	while true do
		hue += 0.01
		if hue > 1 then hue = 0 end
		local color = Color3.fromHSV(hue,1,1)
		Stroke.Color = color
		Title.TextColor3 = color
		task.wait(0.03)
	end
end)

-- HELP TOGGLE
HelpBtn.MouseButton1Click:Connect(function()
	HelpFrame.Visible = not HelpFrame.Visible
end)

-- GET SEAT OR ROOT (oturulan yeri al)
local function getFlyPart(char)
	local hum = char:FindFirstChildWhichIsA("Humanoid")
	if hum and hum.SeatPart then
		return hum.SeatPart
	end
	return char:FindFirstChild("HumanoidRootPart")
end

-- Humanoid state'lerini kontrol et
local function setHumanoidStates(hum, state)
	for _, v in pairs(Enum.HumanoidStateType:GetEnumItems()) do
		hum:SetStateEnabled(v, state)
	end
end

-- TPWalk thread'leri
local function startTPWalk()
	for i = 1, speeds do
		task.spawn(function()
			local hb = RunService.Heartbeat
			while tpwalking and hb:Wait() do
				local chr = LocalPlayer.Character
				local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")
				if chr and hum and hum.Parent and hum.MoveDirection.Magnitude > 0 then
					chr:TranslateBy(hum.MoveDirection)
				end
			end
		end)
	end
end

-- Animasyonları durdur
local function stopAnimations(char)
	local animate = char:FindFirstChild("Animate")
	if animate then
		animate.Disabled = true
	end
	local hum = char:FindFirstChildWhichIsA("Humanoid")
	if hum then
		for _, track in ipairs(hum:GetPlayingAnimationTracks()) do
			track:AdjustSpeed(0)
		end
	end
end

-- Animasyonları geri aç
local function resumeAnimations(char)
	local animate = char:FindFirstChild("Animate")
	if animate then
		animate.Disabled = false
	end
end

-- START FLY (ilk scriptteki mantık)
local function startFly()
	local char = LocalPlayer.Character
	if not char then return end

	local hum = char:FindFirstChildWhichIsA("Humanoid")
	if not hum then return end

	local root = getFlyPart(char)
	if not root then return end

	-- nowe = true (uçuş aktif)
	nowe = true
	tpwalking = true
	startTPWalk()

	-- Animasyonları durdur
	stopAnimations(char)

	-- Humanoid state'lerini kapat ve Swimming'e al
	setHumanoidStates(hum, false)
	hum:ChangeState(Enum.HumanoidStateType.Swimming)

	-- PlatformStand (eğer oturmuyorsa)
	if not hum.SeatPart then
		hum.PlatformStand = true
	end

	-- Body mover'lar
	bg = Instance.new("BodyGyro", root)
	bg.P = 9e4
	bg.MaxTorque = Vector3.new(9e9,9e9,9e9)
	bg.CFrame = root.CFrame

	bv = Instance.new("BodyVelocity", root)
	bv.Velocity = Vector3.new(0,0.1,0)
	bv.MaxForce = Vector3.new(9e9,9e9,9e9)

	-- Kontrol değişkenlerini sıfırla
	ctrl = {f=0,b=0,l=0,r=0}
	lastctrl = {f=0,b=0,l=0,r=0}
	speed = 0

	-- Uçuş döngüsü
	connection = RunService.RenderStepped:Connect(function()
		if not nowe or hum.Health <= 0 then
			return
		end

		-- Hız hesaplama
		if ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0 then
			speed = speed + 0.5 + (speed / maxspeed)
			if speed > maxspeed then speed = maxspeed end
		elseif speed ~= 0 then
			speed = speed - 1
			if speed < 0 then speed = 0 end
		end

		local cam = workspace.CurrentCamera

		if (ctrl.l + ctrl.r) ~= 0 or (ctrl.f + ctrl.b) ~= 0 then
			bv.Velocity =
				((cam.CFrame.LookVector * (ctrl.f + ctrl.b)) +
				((cam.CFrame * CFrame.new(ctrl.l + ctrl.r, (ctrl.f + ctrl.b) * 0.2, 0).Position) - cam.CFrame.Position))
				* speed
			lastctrl = {f=ctrl.f, b=ctrl.b, l=ctrl.l, r=ctrl.r}
		elseif speed ~= 0 then
			bv.Velocity =
				((cam.CFrame.LookVector * (lastctrl.f + lastctrl.b)) +
				((cam.CFrame * CFrame.new(lastctrl.l + lastctrl.r, (lastctrl.f + lastctrl.b) * 0.2, 0).Position) - cam.CFrame.Position))
				* speed
		else
			bv.Velocity = Vector3.zero
		end

		bg.CFrame = cam.CFrame * CFrame.Angles(-math.rad((ctrl.f + ctrl.b) * 50 * speed / maxspeed), 0, 0)
	end)
end

-- STOP FLY
local function stopFly()
	nowe = false
	tpwalking = false

	local char = LocalPlayer.Character
	if char then
		local hum = char:FindFirstChildWhichIsA("Humanoid")
		if hum then
			setHumanoidStates(hum, true)
			hum.PlatformStand = false
		end
		resumeAnimations(char)
	end

	if connection then connection:Disconnect() end
	if bg then bg:Destroy() end
	if bv then bv:Destroy() end
end

-- TOGGLE
local function toggleFly()
	flying = not flying
	
	if flying then
		Toggle.Text = "FLY: ON"
		startFly()
	else
		Toggle.Text = "FLY: OFF"
		stopFly()
	end
end

Toggle.MouseButton1Click:Connect(toggleFly)

-- SPEED butonları (speeds değişir)
SpeedUp.MouseButton1Click:Connect(function()
	speeds += 1
	SpeedLabel.Text = "TPWalk THREAD: "..speeds
end)

SpeedDown.MouseButton1Click:Connect(function()
	if speeds > 1 then
		speeds -= 1
	end
	SpeedLabel.Text = "TPWalk THREAD: "..speeds
end)

-- RESPAWN FIX
LocalPlayer.CharacterAdded:Connect(function()
	if flying then
		stopFly()
		task.wait(0.5)
		startFly()
	end
end)

-- TUŞ KONTROLLERİ (F tuşu ve WASD güncellemesi)
UIS.InputBegan:Connect(function(input, gpe)
	if gpe then return end

	if input.KeyCode == Enum.KeyCode.F then
		toggleFly()
	end

	-- WASD kontrol tablosunu güncelle
	if input.KeyCode == Enum.KeyCode.W then
		ctrl.f = 1
	elseif input.KeyCode == Enum.KeyCode.S then
		ctrl.b = 1
	elseif input.KeyCode == Enum.KeyCode.A then
		ctrl.l = 1
	elseif input.KeyCode == Enum.KeyCode.D then
		ctrl.r = 1
	end
end)

UIS.InputEnded:Connect(function(input, gpe)
	if gpe then return end

	if input.KeyCode == Enum.KeyCode.W then
		ctrl.f = 0
	elseif input.KeyCode == Enum.KeyCode.S then
		ctrl.b = 0
	elseif input.KeyCode == Enum.KeyCode.A then
		ctrl.l = 0
	elseif input.KeyCode == Enum.KeyCode.D then
		ctrl.r = 0
	end
end)

-- +/‑ tuşları ile speeds ayarı (ilk scriptteki gibi)
UIS.InputBegan:Connect(function(input, gpe)
	if gpe then return end

	if input.KeyCode == Enum.KeyCode.Equals then
		speeds += 1
		SpeedLabel.Text = "TPWalk THREAD: "..speeds
		print("Speeds:", speeds)
	end

	if input.KeyCode == Enum.KeyCode.Minus then
		if speeds > 1 then
			speeds -= 1
		end
		SpeedLabel.Text = "TPWalk THREAD: "..speeds
		print("Speeds:", speeds)
	end
end)
